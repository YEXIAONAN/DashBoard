<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"/>
<title>æ™ºæ…§é£Ÿå ‚ - Aiè¥å…»é¡¾é—®</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:#f5f7fa}
.mobile-container{width:100%;max-width:414px;margin:0 auto;background:#f5f7fa;min-height:100vh;display:flex;flex-direction:column}
.header{background:linear-gradient(135deg,#4285f4 0%,#2196f3 100%);color:#fff;padding:15px 20px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100}
.header-left{display:flex;align-items:center;gap:10px}
.back-button{background:rgba(255,255,255,.2);border:none;color:#fff;border-radius:50%;width:32px;height:32px;font-size:16px;cursor:pointer}
.main-content{flex:1;padding:0 16px 80px 16px;overflow-y:auto}
.ai-status-card,.chat-section,.quick-actions{background:#fff;border-radius:12px;margin:16px 0;padding:20px;box-shadow:0 2px 8px rgba(0,0,0,.1)}
.chat-container{height:400px;overflow-y:auto;padding:15px 15px 15px 40px;display:flex;flex-direction:column;gap:12px}
.message{max-width:80%;padding:12px 16px;border-radius:18px;font-size:14px;line-height:1.4}
.user-message{background:#4285f4;color:#fff;align-self:flex-end;border-bottom-right-radius:6px}
.ai-message{background:#f1f3f4;color:#333;align-self:flex-start;border-bottom-left-radius:6px;position:relative}
.ai-message::before{content:'ğŸ¤–';position:absolute;left:-35px;top:50%;transform:translateY(-50%);background:#fff;border-radius:50%;width:24px;height:24px;display:flex;align-items:center;justify-content:center;font-size:18px;box-shadow:0 2px 4px rgba(0,0,0,.1)}
.thinking-toggle-btn{background:none;border:none;color:#4285f4;font-size:12px;cursor:pointer;margin-left:8px}
.thinking-content{display:none;margin-top:6px;font-size:13px;color:#666;white-space:pre-wrap;background:#f8f9fa;padding:8px;border-radius:6px}
.typing-indicator{display:none;align-items:center;gap:8px;padding:12px 16px;background:#f1f3f4;border-radius:18px;max-width:80px;align-self:flex-start;border-bottom-left-radius:6px}
.typing-indicator.active{display:flex}
.typing-dot{width:6px;height:6px;border-radius:50%;background:#4285f4;animation:typing 1.4s infinite ease-in-out}
.typing-dot:nth-child(1){animation-delay:-.32s}
.typing-dot:nth-child(2){animation-delay:-.16s}
.typing-dot:nth-child(3){animation-delay:0}
.welcome-message{text-align:center;color:#666;font-size:14px;margin:30px 0;line-height:1.5}
.quick-buttons{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
.quick-button{background:#f8f9fa;border:none;border-radius:8px;padding:12px 8px;font-size:12px;color:#666;cursor:pointer}
.quick-button:hover{background:#e9ecef}
.input-container{position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:414px;background:#fff;padding:12px 16px;border-top:1px solid #e9ecef;box-shadow:0 -2px 10px rgba(0,0,0,.1)}
.input-wrapper{display:flex;gap:8px;align-items:flex-end}
#messageInput{flex:1;border:1px solid #e9ecef;border-radius:20px;padding:10px 16px;font-size:14px;background:#f8f9fa;resize:none;max-height:80px;min-height:40px;outline:none}
#sendButton{background:#4285f4;color:#fff;border:none;border-radius:50%;width:40px;height:40px;cursor:pointer;font-size:16px}
#sendButton:disabled{opacity:.6;cursor:not-allowed}
@keyframes typing{0%,80%,100%{transform:scale(0);opacity:.5}40%{transform:scale(1);opacity:1}}
</style>
</head>
<body>
<div class="mobile-container">
  <div class="header">
    <div class="header-left">
      <button class="back-button" onclick="history.back()">â†</button>
      <span>ğŸ“</span>
      <span>æ™ºæ…§é£Ÿå ‚ - Aiè¥å…»é¡¾é—®</span>
    </div>
    <div class="avatar">ğŸ¤–</div>
  </div>

  <div class="main-content">
    <div class="ai-status-card">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px">
        <div style="display:flex;align-items:center;gap:8px;font-weight:600">ğŸ¤– Aiè¥å…»é¡¾é—®</div>
        <div style="font-size:12px;color:#4caf50">â— åœ¨çº¿æœåŠ¡</div>
      </div>
      <div style="font-size:14px;color:#666">24å°æ—¶ä¸ºæ‚¨æä¾›ä¸“ä¸šå¥åº·å’¨è¯¢ï¼ŒåŸºäºå…ˆè¿›AIæŠ€æœ¯ï¼Œè§£ç­”å¥åº·é—®é¢˜å¹¶æä¾›ä¸ªæ€§åŒ–å»ºè®®ã€‚</div>
    </div>

    <div class="chat-section">
      <div style="background:#f8f9fa;padding:15px 20px;border-bottom:1px solid #e9ecef;font-weight:600">ğŸ’¬ å¥åº·å’¨è¯¢å¯¹è¯</div>
      <div class="chat-container" id="chatContainer">
        <div class="welcome-message">
          <span style="font-size:24px">ğŸ‘‹</span>
          æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„AIå¥åº·é¡¾é—®<br>å¾ˆé«˜å…´ä¸ºæ‚¨æœåŠ¡ï¼<br><br>
          è¯·å‘Šè¯‰æˆ‘æ‚¨çš„å¥åº·é—®é¢˜æˆ–éœ€æ±‚<br>æˆ‘ä¼šå°½åŠ›ä¸ºæ‚¨æä¾›ä¸“ä¸šå»ºè®®
        </div>
        <div class="typing-indicator" id="typingIndicator">
          <div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>
        </div>
      </div>
    </div>

    <div class="quick-actions">
      <div style="font-weight:600;margin-bottom:15px">âš¡ å¿«æ·å’¨è¯¢</div>
      <div class="quick-buttons">
        <button class="quick-button" onclick="sendQuick('æˆ‘æƒ³äº†è§£ä¸€ä¸‹å¥åº·é¥®é£Ÿçš„å»ºè®®')">ğŸ¥—<br>å¥åº·é¥®é£Ÿ</button>
        <button class="quick-button" onclick="sendQuick('è¯·æ¨èä¸€äº›é€‚åˆçš„è¿åŠ¨æ–¹å¼')">ğŸƒâ€â™€ï¸<br>è¿åŠ¨å»ºè®®</button>
        <button class="quick-button" onclick="sendQuick('æˆ‘æœ€è¿‘ç¡çœ è´¨é‡ä¸å¥½ï¼Œæœ‰ä»€ä¹ˆæ”¹å–„æ–¹æ³•å—ï¼Ÿ')">ğŸ˜´<br>ç¡çœ å¥åº·</button>
        <button class="quick-button" onclick="sendQuick('å¦‚ä½•æœ‰æ•ˆç¼“è§£å·¥ä½œå‹åŠ›ï¼Ÿ')">ğŸ§˜â€â™€ï¸<br>å‹åŠ›ç®¡ç†</button>
        <button class="quick-button" onclick="sendQuick('è¯·ä»‹ç»ä¸€äº›å…»ç”Ÿä¿å¥çš„æ–¹æ³•')">ğŸŒ¿<br>å…»ç”Ÿä¿å¥</button>
        <button class="quick-button" onclick="sendQuick('æˆ‘æƒ³äº†è§£å¦‚ä½•é¢„é˜²å¸¸è§ç–¾ç—…')">ğŸ›¡ï¸<br>ç–¾ç—…é¢„é˜²</button>
      </div>
    </div>
  </div>

  <div class="input-container">
    <div class="input-wrapper">
      <textarea id="messageInput" placeholder="è¯·è¾“å…¥æ‚¨çš„å¥åº·é—®é¢˜â€¦" rows="1"></textarea>
      <button id="sendButton">â¤</button>
    </div>
  </div>
</div>

<script>
let isProcessing=false;
const chatBox=document.getElementById('chatContainer');
const input=document.getElementById('messageInput');
const sendBtn=document.getElementById('sendButton');
const typing=document.getElementById('typingIndicator');

function scrollBottom(){setTimeout(()=>chatBox.scrollTop=chatBox.scrollHeight,100)}
function addMsg(text,type){
  const div=document.createElement('div');
  div.className='message '+(type==='user'?'user-message':'ai-message');
  div.textContent=text;
  chatBox.insertBefore(div,typing);
  scrollBottom();
}

function toggleThink(btn){
  const content=btn.nextElementSibling;
  const open=content.style.display==='block';
  content.style.display=open?'none':'block';
  btn.textContent=open?'ğŸ¤” æŸ¥çœ‹æ€è€ƒ':'ğŸ¤” æ”¶èµ·æ€è€ƒ';
}

function sendQuick(msg){
  input.value=msg;
  sendMsg();
}

async function sendMsg(){
  const text=input.value.trim();
  if(!text||isProcessing) return;
  addMsg(text,'user');
  input.value='';
  isProcessing=true;
  sendBtn.disabled=true;
  scrollBottom();

  // åˆ›å»ºæ€è€ƒä¸­æ¶ˆæ¯
  const thinkDiv=document.createElement('div');
  thinkDiv.className='message ai-message';
  const timerSpan=document.createElement('span');
  thinkDiv.appendChild(timerSpan);
  chatBox.insertBefore(thinkDiv,typing);

  const start=Date.now();
  const timer=setInterval(()=>{
    timerSpan.textContent=`ğŸ¤” AI æ­£åœ¨æ€è€ƒä¸­â€¦ï¼ˆ${((Date.now()-start)/1000).toFixed(1)} ç§’ï¼‰`;
    scrollBottom();
  },200);

  const controller=new AbortController();
  try{
    const res=await fetch('http://192.168.101.247:11434/api/chat',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({
        model:'deepseek-r1:70b',
        messages:[{role:'system',content:'ä½ æ˜¯å¥åº·é¡¾é—®ï¼Œç”¨ä¸­æ–‡ï¼Œç®€æ´ä¸“ä¸šã€‚'},{role:'user',content:text}],
        stream:true
      }),
      signal:controller.signal
    });
    const reader=res.body.getReader();
    const decoder=new TextDecoder();
    let buffer='';
    let thinking='';
    let answer='';
    let thinkingDone=false;

    while(true){
      const {done,value}=await reader.read();
      if(done) break;
      buffer+=decoder.decode(value,{stream:true});
      const lines=buffer.split('\n');
      buffer=lines.pop()||'';
      for(const l of lines){
        if(!l.trim()) continue;
        try{
          const d=JSON.parse(l);
          const c=d.message?.content||'';
          if(!thinkingDone){
            const m=c.match(/<think>([\s\S]*?)<\/think>/);
            if(m) thinking+=m[1];
            if(c.includes('</think>')) thinkingDone=true;
          }else{
            answer+=c;
            // æµå¼è¾“å‡º
            if(!answerDiv){
              clearInterval(timer);
              thinkDiv.innerHTML=''; // æ¸…é™¤æ€è€ƒä¸­
              answerDiv=document.createElement('div');
              answerDiv.className='message ai-message';
              chatBox.insertBefore(answerDiv,typing);
            }
            answerDiv.innerHTML=`
              <div>
                âœ… AI æ€è€ƒå®Œæ¯• ${thinking?`<button class="thinking-toggle-btn" onclick="toggleThink(this)">ğŸ¤” æŸ¥çœ‹æ€è€ƒ</button>`:''}
                ${thinking?`<div class="thinking-content">${thinking}</div>`:''}
              </div>
              <div style="margin-top:8px">${answer}</div>
            `;
            scrollBottom();
          }
        }catch{}
      }
    }
    clearInterval(timer);
    if(!answerDiv){
      thinkDiv.innerHTML='';
      answerDiv=document.createElement('div');
      answerDiv.className='message ai-message';
      chatBox.insertBefore(answerDiv,typing);
      answerDiv.innerHTML=`
        <div>
          âœ… AI æ€è€ƒå®Œæ¯• ${thinking?`<button class="thinking-toggle-btn" onclick="toggleThink(this)">ğŸ¤” æŸ¥çœ‹æ€è€ƒ</button>`:''}
          ${thinking?`<div class="thinking-content">${thinking}</div>`:''}
        </div>
        <div style="margin-top:8px">${answer||'æŠ±æ­‰ï¼Œæˆ‘æš‚æ—¶æ— æ³•å›ç­”æ‚¨çš„é—®é¢˜ã€‚'}</div>
      `;
    }
  }catch{
    clearInterval(timer);
    thinkDiv.textContent='æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åå†è¯•ã€‚';
  }finally{
    isProcessing=false;
    sendBtn.disabled=false;
  }
  let answerDiv=null;
}

sendBtn.addEventListener('click',sendMsg);
input.addEventListener('keydown',e=>{
  if(e.key==='Enter'&&!e.shiftKey&&!isProcessing){e.preventDefault();sendMsg()}
});
</script>
</body>
</html>