{% load static %}
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <!-- Meta Tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <!-- SEO Meta Tags -->
    <title>{% block title %}DashBoard - 智慧餐饮系统{% endblock %}</title>
    <meta name="description" content="{% block meta_description %}DashBoard智慧餐饮系统 - 提供个性化点餐、营养追踪和健康建议服务{% endblock %}">
    <meta name="keywords" content="{% block meta_keywords %}餐饮系统,点餐,营养追踪,健康饮食,AI健康顾问{% endblock %}">
    <meta name="author" content="DashBoard">
    
    <!-- Open Graph Meta Tags for Social Sharing -->
    <meta property="og:title" content="{% block og_title %}DashBoard - 智慧餐饮系统{% endblock %}">
    <meta property="og:description" content="{% block og_description %}DashBoard智慧餐饮系统 - 提供个性化点餐、营养追踪和健康建议服务{% endblock %}">
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ request.build_absolute_uri }}">
    <meta property="og:image" content="{% block og_image %}{% static 'Images/og-image.jpg' %}{% endblock %}">
    <meta property="og:site_name" content="DashBoard">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{% block twitter_title %}DashBoard - 智慧餐饮系统{% endblock %}">
    <meta name="twitter:description" content="{% block twitter_description %}DashBoard智慧餐饮系统 - 提供个性化点餐、营养追踪和健康建议服务{% endblock %}">
    <meta name="twitter:image" content="{% block twitter_image %}{% static 'Images/og-image.jpg' %}{% endblock %}">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{% static 'Images/favicon.ico' %}">
    <link rel="apple-touch-icon" href="{% static 'Images/apple-touch-icon.png' %}">
    
    <!-- Preload Critical Fonts -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;600;700&family=Open+Sans:wght@400;600&display=swap" as="style">
    
    <!-- Design System CSS -->
    <link rel="stylesheet" href="{% static 'css/reset.css' %}">
    <link rel="stylesheet" href="{% static 'css/design-system.css' %}">
    <link rel="stylesheet" href="{% static 'css/base-components.css' %}">
    <link rel="stylesheet" href="{% static 'css/components.css' %}">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;600;700&family=Open+Sans:wght@400;600&display=swap">
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="{% static 'css/all.min.css' %}">
    
    <!-- Page-Specific CSS -->
    {% block extra_css %}{% endblock %}
    
    <!-- Robots Meta Tag -->
    <meta name="robots" content="{% block robots %}index, follow{% endblock %}">
</head>
<body>
    <!-- Skip to Main Content Link for Accessibility -->
    <a href="#main-content" class="skip-link">跳转到主内容</a>
    
    <!-- Header -->
    <header role="banner" class="site-header">
        {% block header %}
        <!-- Navigation Bar -->
        <nav role="navigation" aria-label="主导航" class="navbar">
            <div class="navbar__container">
                <!-- Brand Logo -->
                <a href="{% url 'index' %}" class="navbar__brand">
                    <img src="{% static 'Images/logo.svg' %}" alt="DashBoard Logo" class="navbar__logo">
                    <span class="navbar__brand-text">DashBoard</span>
                </a>
                
                <!-- Mobile Menu Toggle -->
                <button class="navbar__toggle" aria-label="切换导航菜单" aria-expanded="false" aria-controls="navbar-menu">
                    <span class="navbar__toggle-icon"></span>
                    <span class="navbar__toggle-icon"></span>
                    <span class="navbar__toggle-icon"></span>
                </button>
                
                <!-- Navigation Menu -->
                <ul class="navbar__menu" id="navbar-menu">
                    {% if user.is_authenticated %}
                    <li class="navbar__item">
                        <a href="{% url 'index' %}" class="navbar__link {% if current_page == 'index' %}navbar__link--active{% endif %}">
                            <i class="fas fa-home" aria-hidden="true"></i>
                            <span>首页</span>
                        </a>
                    </li>
                    <li class="navbar__item">
                        <a href="{% url 'orders' %}" class="navbar__link {% if current_page == 'orders' %}navbar__link--active{% endif %}">
                            <i class="fas fa-utensils" aria-hidden="true"></i>
                            <span>点餐</span>
                        </a>
                    </li>
                    <li class="navbar__item">
                        <a href="{% url 'profile' %}" class="navbar__link {% if current_page == 'profile' %}navbar__link--active{% endif %}">
                            <i class="fas fa-user" aria-hidden="true"></i>
                            <span>个人中心</span>
                        </a>
                    </li>
                    <li class="navbar__item">
                        <a href="{% url 'repo' %}" class="navbar__link {% if current_page == 'repo' %}navbar__link--active{% endif %}">
                            <i class="fas fa-chart-line" aria-hidden="true"></i>
                            <span>营养报告</span>
                        </a>
                    </li>
                    <li class="navbar__item">
                        <a href="{% url 'order_history' %}" class="navbar__link {% if current_page == 'order_history' %}navbar__link--active{% endif %}">
                            <i class="fas fa-history" aria-hidden="true"></i>
                            <span>订单历史</span>
                        </a>
                    </li>
                    <li class="navbar__item">
                        <a href="{% url 'ai_health_advisor' %}" class="navbar__link {% if current_page == 'ai_health_advisor' %}navbar__link--active{% endif %}">
                            <i class="fas fa-robot" aria-hidden="true"></i>
                            <span>AI顾问</span>
                        </a>
                    </li>
                    <li class="navbar__item navbar__item--user">
                        <span class="navbar__user-info">
                            <i class="fas fa-user-circle" aria-hidden="true"></i>
                            <span>{{ user.username }}</span>
                        </span>
                    </li>
                    {% else %}
                    <li class="navbar__item">
                        <a href="{% url 'login' %}" class="navbar__link">
                            <i class="fas fa-sign-in-alt" aria-hidden="true"></i>
                            <span>登录</span>
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </div>
        </nav>
        {% endblock %}
    </header>
    
    <!-- Main Content -->
    <main id="main-content" role="main" class="main-content">
        {% block content %}
        <!-- Page-specific content goes here -->
        {% endblock %}
    </main>
    
    <!-- Footer -->
    <footer role="contentinfo" class="site-footer">
        {% block footer %}
        <div class="footer__container">
            <div class="footer__content">
                <div class="footer__section">
                    <h3 class="footer__title">关于我们</h3>
                    <p class="footer__text">DashBoard智慧餐饮系统致力于为用户提供健康、便捷的点餐体验。</p>
                </div>
                <div class="footer__section">
                    <h3 class="footer__title">快速链接</h3>
                    <ul class="footer__links">
                        <li><a href="{% url 'index' %}" class="footer__link">首页</a></li>
                        <li><a href="{% url 'orders' %}" class="footer__link">点餐</a></li>
                        <li><a href="{% url 'repo' %}" class="footer__link">营养报告</a></li>
                    </ul>
                </div>
                <div class="footer__section">
                    <h3 class="footer__title">联系我们</h3>
                    <p class="footer__text">
                        <i class="fas fa-envelope" aria-hidden="true"></i>
                        <a href="mailto:support@dashboard.com" class="footer__link">support@dashboard.com</a>
                    </p>
                </div>
            </div>
            <div class="footer__bottom">
                <p class="footer__copyright">
                    &copy; {% now "Y" %} DashBoard. All rights reserved.
                </p>
            </div>
        </div>
        {% endblock %}
    </footer>
    
    <!-- Toast Notification Container -->
    <div class="toast-container" role="region" aria-live="polite" aria-label="通知消息"></div>
    
    <!-- Loading Indicator (Hidden by default) -->
    <div class="loading-overlay" id="loading-overlay" style="display: none;" role="status" aria-live="polite">
        <div class="loading-indicator">
            <div class="loading-indicator__spinner"></div>
            <p class="loading-indicator__text">加载中...</p>
        </div>
    </div>
    
    <!-- Core JavaScript -->
    <script>
        // CSRF Token Helper for AJAX requests
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        
        // Mobile Navigation Toggle
        document.addEventListener('DOMContentLoaded', function() {
            const navToggle = document.querySelector('.navbar__toggle');
            const navMenu = document.querySelector('.navbar__menu');
            
            if (navToggle && navMenu) {
                navToggle.addEventListener('click', function() {
                    const isExpanded = this.getAttribute('aria-expanded') === 'true';
                    this.setAttribute('aria-expanded', !isExpanded);
                    navMenu.classList.toggle('is-open');
                    document.body.classList.toggle('nav-open');
                });
                
                // Close menu when clicking outside
                document.addEventListener('click', function(event) {
                    if (!navToggle.contains(event.target) && !navMenu.contains(event.target)) {
                        navToggle.setAttribute('aria-expanded', 'false');
                        navMenu.classList.remove('is-open');
                        document.body.classList.remove('nav-open');
                    }
                });
                
                // Close menu on escape key
                document.addEventListener('keydown', function(event) {
                    if (event.key === 'Escape' && navMenu.classList.contains('is-open')) {
                        navToggle.setAttribute('aria-expanded', 'false');
                        navMenu.classList.remove('is-open');
                        document.body.classList.remove('nav-open');
                        navToggle.focus();
                    }
                });
            }
            
            // Skip link functionality
            const skipLink = document.querySelector('.skip-link');
            if (skipLink) {
                skipLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    const mainContent = document.getElementById('main-content');
                    if (mainContent) {
                        mainContent.setAttribute('tabindex', '-1');
                        mainContent.focus();
                    }
                });
            }
        });
        
        // Global Loading Indicator Functions
        function showLoading() {
            const overlay = document.getElementById('loading-overlay');
            if (overlay) {
                overlay.style.display = 'flex';
            }
        }
        
        function hideLoading() {
            const overlay = document.getElementById('loading-overlay');
            if (overlay) {
                overlay.style.display = 'none';
            }
        }
    </script>
    
    <!-- Page-Specific JavaScript -->
    {% block extra_js %}{% endblock %}
</body>
</html>
