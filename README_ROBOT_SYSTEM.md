# 点餐-机械臂任务控制系统

## 系统概述

本系统实现了完整的点餐-机械臂任务控制系统，支持用户点餐后通过点击"取餐"按钮触发机械臂任务流程。

## 核心功能

### 1. 触发机制
- **记录点餐**: 用户完成点餐后，系统记录点选的菜品列表，但不自动执行任务
- **手动触发**: 仅当用户点击"取餐"按钮时，才启动机械臂任务流程

### 2. 分类与执行顺序
- **肉类**: 红烧排骨、花菜牛腩、烤鸭
- **素菜**: 清炒黑木耳、清炒莲藕
- **主食**: 米饭
- **执行顺序**: 肉类 → 素菜 → 主食（保持用户点选顺序）

### 3. 任务ID映射

| 菜品名称 | 机械臂任务ID |
|----------|--------------|
| 烤鸭     | id101        |
| 红烧排骨 | id102        |
| 花菜牛腩 | id103        |
| 清炒黑木耳 | id104      |
| 清炒莲藕 | id105        |
| 米饭     | id106        |

### 4. YOLOv5检测集成
- 对每个菜品调用YOLOv5模型检测是否存在
- 单菜品检测超时：5秒
- 超时提示："没有找到[菜品名称]请及时补货"
- 检测通过的菜品正常执行任务，未通过的跳过

## 系统架构

### 文件结构
```
Dashboard/
├── main/
│   ├── api.py              # 机械臂控制API
│   ├── views.py            # 视图函数
│   └── templates/
│       └── order_status.html # 订单状态页面
├── yolov5_stream.py        # YOLOv5检测服务
├── dish_task_config.py     # 菜品任务配置

├── start_system.bat      # 系统启动脚本
└── README_ROBOT_SYSTEM.md  # 系统文档
```

### API端点
- `GET /execute_order_tasks/?order_id=xxx` - 执行订单任务
- `GET /detect?class=xxx` - YOLO检测接口
- `GET /video_feed` - 视频流接口

## 使用方法

### 1. 启动系统
```bash
# Windows
start_system.bat

# 手动启动
python yolov5_stream.py  # 启动YOLO检测服务
python manage.py runserver 0.0.0.0:8000  # 启动Django服务
```



### 3. 使用流程
1. 用户完成点餐
2. 系统跳转到订单状态页面
3. 用户点击"取餐"按钮
4. 系统按顺序执行菜品检测和机械臂任务

## 配置说明

### 菜品任务配置 (dish_task_config.py)
```python
# 菜品任务ID映射
DISH_TASK_MAPPING = {
    '烤鸭': 'id101',
    '红烧排骨': 'id102',
    # ...
}

# 菜品分类
DISH_CATEGORIES = {
    '肉类': ['红烧排骨', '花菜牛腩', '烤鸭'],
    '素菜': ['清炒黑木耳', '清炒莲藕'],
    '主食': ['米饭']
}
```

### 机械臂配置
- 机器人IP: 192.168.101.147
- 使用lebai_sdk进行控制

## 故障排除

### 常见问题
1. **YOLO检测服务无法连接**
   - 检查服务是否启动
   - 检查端口5000是否被占用

2. **机械臂无法连接**
   - 检查机器人IP地址
   - 检查网络连接

3. **订单ID无法获取**
   - 检查URL参数
   - 检查订单状态页面模板

### 日志查看
- Django日志: 控制台输出
- YOLO检测日志: 控制台输出
- 机械臂日志: 控制台输出

## 扩展建议

1. **添加新菜品**: 修改dish_task_config.py
2. **调整检测超时**: 修改api.py中的timeout参数
3. **优化检测精度**: 调整YOLOv5模型参数
4. **添加通知功能**: 集成WebSocket实时通知

## 注意事项

1. 确保YOLOv5模型已正确训练
2. 确保机械臂网络连接稳定
3. 定期检查菜品库存
4. 监控检测超时情况