# iOS 风格液态玻璃滚动动效 - 快速参考

## ✅ 已完成功能清单

### 1️⃣ 热量卡片消失动效
- **位移动画**: 0 → -80px（向上推离）
- **缩放动画**: 1 → 0.72（连续渐变缩小）
- **透明度**: 1 → 0（平方曲线柔和消失）
- **模糊效果**: 0 → 14px（根据速度动态调整，最大 18px）
- **动画曲线**: `cubic-bezier(0.25, 0.46, 0.45, 0.94)` - iOS 标准弹性曲线
- **时长**: 600ms（transform）、500ms（opacity/filter）

### 2️⃣ 营养素模块液态上浮
- **位移动画**: +40px → 0（从下方流动上来）
- **垂直拉伸**: scaleY 0.96 → 1（轻微形变）
- **透明度**: 0.85 → 1（渐显）
- **液态扭曲**: skewY 根据滚动速度动态计算（最大 ±3°）
- **边缘波动**: clip-path polygon 实现顶部边缘水波效果（2-6px）
- **动画曲线**: `cubic-bezier(0.25, 0.46, 0.45, 0.94)`
- **时长**: 650ms

### 3️⃣ 光学折射与色散
- **RGB 色散**: drop-shadow 实现红绿蓝分离（1-2px）
- **触发条件**: 仅在滚动速度 > 2 时激活
- **颜色**: 
  - 绿色主色调: `rgba(139, 157, 131, 0.3)`
  - 浅绿辅助: `rgba(156, 175, 136, 0.2)`
- **恢复**: 滚动停止后 100ms 自动清除

### 4️⃣ 滚动物理系统
- **摩擦力**: 0.92（阻尼系数）
- **质量感**: 1.2（模拟玻璃重量）
- **张力**: 280
- **阻尼**: 28
- **速度检测**: 实时计算 scrollVelocity
- **停止检测**: 150ms 无滚动后触发恢复

### 5️⃣ 移动端触摸惯性
- **触摸追踪**: touchstart/touchmove/touchend
- **速度计算**: deltaY / deltaTime
- **惯性阈值**: 0.5（低于此值不触发）
- **摩擦衰减**: velocity *= 0.92（每帧）
- **自动停止**: 速度 < 0.1 时结束

### 6️⃣ 性能优化
- **will-change**: transform, opacity（提前通知浏览器）
- **transform-origin**: 正确的缩放中心点
- **requestAnimationFrame**: 避免布局抖动
- **passive 事件**: 提升滚动性能
- **条件渲染**: 仅在卡片可见时应用效果

## 🎨 视觉效果特点

### 克制与精致
- ❌ 无夸张弹跳
- ❌ 无线性动画
- ❌ 无硬切换
- ✅ 连续渐变
- ✅ 柔和收尾
- ✅ 微妙形变

### iOS 风格曲线
```javascript
cubic-bezier(0.25, 0.46, 0.45, 0.94)  // 标准 iOS ease-in-out
```

### 动效时长
- 快速响应: 450-500ms（opacity/filter）
- 主要动画: 600-650ms（transform）
- 恢复动画: 400ms（clip-path）

## 📊 触发逻辑

### 滚动进度计算
```javascript
scrollProgress = -cardTop / (cardHeight * 0.6)
// 范围: 0-1
// 0 = 卡片顶部对齐视口顶部
// 1 = 卡片滚动了 60% 高度
```

### 效果映射
| 进度 | 热量卡片 | 营养素模块 |
|------|----------|------------|
| 0% | 完全可见 | 在下方 +40px |
| 50% | 半透明、缩小 | 上浮中 |
| 100% | 消失、模糊 | 完全覆盖 |

## 🔧 关键代码位置

### HTML 结构
- **热量卡片**: `.calorie-section`（第 598-625 行）
- **营养素模块**: `.nutrients-section`（第 628-715 行）

### CSS 样式
- **will-change**: 第 113、189 行
- **transform-origin**: 第 114 行
- **悬停光泽**: 第 267-278 行

### JavaScript 动效
- **初始化**: 第 838 行 `initLiquidGlassScroll()`
- **滚动监听**: 第 858-886 行
- **热量卡片效果**: 第 900-918 行
- **营养素效果**: 第 921-955 行
- **色散效果**: 第 958-975 行
- **触摸惯性**: 第 993-1029 行

## 🎯 用户体验目标

> "像在推动一块有重量的液态玻璃，而不是在滚动网页。"

### 实现方式
1. **重量感**: 延迟跟随（30-60ms）+ 惯性滑行
2. **液态感**: 边缘波动 + 轻微扭曲
3. **玻璃感**: 模糊 + 透明度 + 光学折射
4. **精致感**: 克制的参数 + iOS 曲线

## 📱 兼容性

### 浏览器支持
- ✅ Chrome/Edge 90+
- ✅ Safari 14+（iOS/macOS）
- ✅ Firefox 88+
- ⚠️ 旧版浏览器会降级为基础滚动

### 性能
- **60fps**: 在现代设备上流畅运行
- **GPU 加速**: transform/opacity 使用硬件加速
- **内存**: 无内存泄漏（正确清理 RAF）

## 🚀 测试建议

### 桌面端
1. 缓慢向上滚动 → 观察热量卡片消失
2. 快速滚动 → 观察色散效果
3. 停止滚动 → 观察平滑恢复

### 移动端
1. 手指拖动 → 感受延迟跟随
2. 快速滑动 → 体验惯性滚动
3. 边缘观察 → 查看波动效果

## 📝 注意事项

### 禁止修改
- ❌ 不要改变布局结构
- ❌ 不要修改配色方案
- ❌ 不要调整组件层级

### 允许调整
- ✅ 动画时长（450-700ms 范围内）
- ✅ 模糊强度（10-18px 范围内）
- ✅ 速度阈值（根据设备性能）

### 调试技巧
```javascript
// 在控制台查看滚动速度
console.log('Velocity:', scrollVelocity);

// 查看滚动进度
console.log('Progress:', scrollProgress);

// 查看触摸速度
console.log('Touch Velocity:', touchVelocity);
```

## ✨ 最终效果

- **视觉**: 液态玻璃质感，光学折射，微妙形变
- **交互**: 有重量感的推动，惯性滑行，柔和收尾
- **性能**: 60fps 流畅，GPU 加速，低内存占用
- **风格**: iOS/Apple 标准，克制精致，不打扰阅读

---

**实现状态**: ✅ 完成  
**测试状态**: ⏳ 待用户测试  
**文档版本**: v1.0  
**最后更新**: 2026-01-25
