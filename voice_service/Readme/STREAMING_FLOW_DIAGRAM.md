# AI è¯­éŸ³åŠ©æ‰‹æµå¼è¾“å‡ºæµç¨‹å›¾

## æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç”¨æˆ·ç•Œé¢                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ æ–‡æœ¬è¾“å…¥ â”‚  â”‚ è¯­éŸ³å½•åˆ¶ â”‚  â”‚ å¯¹è¯æ˜¾ç¤º â”‚  â”‚ éŸ³é¢‘æ’­æ”¾ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“ â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FastAPI æœåŠ¡ (8001)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ /transcribe  â”‚  â”‚ /chat-stream â”‚  â”‚    /chat     â”‚     â”‚
â”‚  â”‚  (è¯­éŸ³è¯†åˆ«)   â”‚  â”‚  (æµå¼å¯¹è¯)   â”‚  â”‚  (ä¼ ç»Ÿæ¥å£)   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“                    â†“                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        AI æœåŠ¡å±‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚   Whisper    â”‚  â”‚    Ollama    â”‚  â”‚   edge-tts   â”‚     â”‚
â”‚  â”‚  (è¯­éŸ³è¯†åˆ«)   â”‚  â”‚   (LLM å¯¹è¯)  â”‚  â”‚  (è¯­éŸ³åˆæˆ)   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## è¯­éŸ³è¾“å…¥æµç¨‹ï¼ˆæ–°ç‰ˆæœ¬ - ä¸¤æ­¥å¤„ç†ï¼‰

```
ç”¨æˆ·ç‚¹å‡»å½•éŸ³æŒ‰é’®
        â†“
    å¼€å§‹å½•éŸ³ ğŸ¤
        â†“
    ç”¨æˆ·è¯´è¯...
        â†“
    ç‚¹å‡»åœæ­¢å½•éŸ³
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬ä¸€æ­¥ï¼šå¿«é€Ÿè¯­éŸ³è¯†åˆ«                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
    æ˜¾ç¤ºå ä½ç¬¦
    "ğŸ¤ æ­£åœ¨è¯†åˆ«è¯­éŸ³..."
        â†“
    POST /transcribe
    (å‘é€éŸ³é¢‘æ–‡ä»¶)
        â†“
    Whisper è¯†åˆ«
    (small æ¨¡å‹)
        â†“
    è¿”å›è¯†åˆ«æ–‡æœ¬
    {"text": "ä½ å¥½"}
        â†“
    âš¡ ç«‹å³æ›´æ–°ç•Œé¢
    "ğŸ¤ 'ä½ å¥½'"
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬äºŒæ­¥ï¼šæµå¼è·å– AI å›å¤                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
    æ˜¾ç¤ºæ‰“å­—æŒ‡ç¤ºå™¨
    â— â— â—
        â†“
    POST /chat-stream
    (å‘é€è¯†åˆ«æ–‡æœ¬)
        â†“
    Ollama æµå¼ç”Ÿæˆ
    (qwen2.5:7b)
        â†“
    SSE æµå¼ä¼ è¾“
    data: {"text": "ä½ "}
    data: {"text": "å¥½"}
    data: {"text": "ï¼"}
    ...
        â†“
    å‰ç«¯é€å­—æ˜¾ç¤º
    "ä½ " â†’ "ä½ å¥½" â†’ "ä½ å¥½ï¼" â†’ ...
        â†“
    ç”Ÿæˆå®Œæˆ
    data: {"audio": "base64...", "done": true}
        â†“
    edge-tts åˆæˆè¯­éŸ³
        â†“
    è‡ªåŠ¨æ’­æ”¾éŸ³é¢‘ ğŸ”Š
```

## æ–‡å­—è¾“å…¥æµç¨‹ï¼ˆæ–°ç‰ˆæœ¬ - æµå¼è¾“å‡ºï¼‰

```
ç”¨æˆ·è¾“å…¥æ–‡å­—
"ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"
        â†“
    ç‚¹å‡»å‘é€æŒ‰é’® âœˆï¸
        â†“
    æ˜¾ç¤ºç”¨æˆ·æ¶ˆæ¯
    [ç”¨æˆ·] ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ
        â†“
    æ˜¾ç¤ºæ‰“å­—æŒ‡ç¤ºå™¨
    â— â— â—
        â†“
    POST /chat-stream
    (å‘é€æ–‡æœ¬)
        â†“
    Ollama æµå¼ç”Ÿæˆ
        â†“
    SSE æµå¼ä¼ è¾“
    data: {"text": "ä»Š"}
    data: {"text": "å¤©"}
    data: {"text": "å¤©"}
    data: {"text": "æ°”"}
    ...
        â†“
    å‰ç«¯é€å­—æ˜¾ç¤º
    "ä»Š" â†’ "ä»Šå¤©" â†’ "ä»Šå¤©å¤©" â†’ "ä»Šå¤©å¤©æ°”" â†’ ...
        â†“
    ç”Ÿæˆå®Œæˆ
    data: {"audio": "base64...", "done": true}
        â†“
    edge-tts åˆæˆè¯­éŸ³
        â†“
    è‡ªåŠ¨æ’­æ”¾éŸ³é¢‘ ğŸ”Š
```

## æ—§ç‰ˆæœ¬ vs æ–°ç‰ˆæœ¬å¯¹æ¯”

### æ—§ç‰ˆæœ¬ï¼ˆä¸€æ­¥å¤„ç†ï¼‰
```
å½•éŸ³ â†’ ç­‰å¾…... â†’ ä¸€æ¬¡æ€§æ˜¾ç¤ºå…¨éƒ¨å†…å®¹ + éŸ³é¢‘
      â±ï¸ 10-15ç§’
      âŒ æ— ä¸­é—´åé¦ˆ
      âŒ ä¸çŸ¥é“è¯†åˆ«äº†ä»€ä¹ˆ
```

### æ–°ç‰ˆæœ¬ï¼ˆä¸¤æ­¥å¤„ç† + æµå¼è¾“å‡ºï¼‰
```
å½•éŸ³ â†’ âš¡ ç«‹å³æ˜¾ç¤ºè¯†åˆ«ç»“æœ â†’ é€å­—æ˜¾ç¤º AI å›å¤ â†’ éŸ³é¢‘
      â±ï¸ 2-3ç§’           â±ï¸ å®æ—¶æ˜¾ç¤º
      âœ… å¿«é€Ÿåé¦ˆ          âœ… æ‰“å­—æœºæ•ˆæœ
      âœ… çœ‹åˆ°è¯†åˆ«å†…å®¹       âœ… æµç•…ä½“éªŒ
```

## åç«¯æµå¼å¤„ç†è¯¦è§£

### /chat-stream æ¥å£å¤„ç†æµç¨‹

```python
async def chat_stream(text: str):
    full_text = ""  # ç´¯ç§¯å®Œæ•´æ–‡æœ¬
    
    # è¿æ¥ Ollama æµå¼ API
    async with client.stream("POST", ollama_url, json=payload):
        
        # é€è¡Œè¯»å–å“åº”
        async for line in response.aiter_lines():
            data = json.loads(line)
            
            if "response" in data:
                chunk = data["response"]  # è·å–æ–‡æœ¬å—
                full_text += chunk        # ç´¯ç§¯æ–‡æœ¬
                
                # ç«‹å³å‘é€ç»™å‰ç«¯
                yield f"data: {json.dumps({'text': chunk})}\n\n"
            
            if data.get("done"):
                # ä½¿ç”¨å®Œæ•´æ–‡æœ¬ç”Ÿæˆè¯­éŸ³
                audio = await text_to_speech(full_text)
                audio_base64 = base64.b64encode(audio)
                
                # å‘é€éŸ³é¢‘å’Œå®Œæˆæ ‡å¿—
                yield f"data: {json.dumps({'audio': audio_base64, 'done': True})}\n\n"
```

## å‰ç«¯æµå¼æ¥æ”¶è¯¦è§£

### sendTextStream å‡½æ•°å¤„ç†æµç¨‹

```javascript
async function sendTextStream(text) {
    // 1. åˆ›å»ºæ¶ˆæ¯å®¹å™¨
    const messageDiv = document.createElement('div');
    const textSpan = document.createElement('span');
    
    // 2. å‘é€è¯·æ±‚
    const response = await fetch(CHAT_STREAM_URL, {
        method: 'POST',
        body: formData
    });
    
    // 3. è¯»å–æµå¼å“åº”
    const reader = response.body.getReader();
    const decoder = new TextDecoder();
    let fullText = '';
    
    while (true) {
        const { done, value } = await reader.read();
        if (done) break;
        
        // 4. è§£ç æ•°æ®
        const chunk = decoder.decode(value);
        const lines = chunk.split('\n');
        
        for (const line of lines) {
            if (line.startsWith('data: ')) {
                const data = JSON.parse(line.slice(6));
                
                // 5. é€å­—æ›´æ–°ç•Œé¢
                if (data.text) {
                    fullText += data.text;
                    textSpan.textContent = fullText;
                    // è‡ªåŠ¨æ»šåŠ¨
                    chatDisplay.scrollTop = chatDisplay.scrollHeight;
                }
                
                // 6. æ’­æ”¾éŸ³é¢‘
                if (data.audio && data.done) {
                    audioPlayer.src = `data:audio/mp3;base64,${data.audio}`;
                    audioPlayer.play();
                }
            }
        }
    }
}
```

## æ—¶é—´çº¿å¯¹æ¯”

### æ—§ç‰ˆæœ¬æ—¶é—´çº¿
```
0s    ç”¨æˆ·ç‚¹å‡»å½•éŸ³
3s    ç”¨æˆ·è¯´å®Œè¯ï¼Œç‚¹å‡»åœæ­¢
3s    æ˜¾ç¤º [è¯­éŸ³æ¶ˆæ¯]
3s    å¼€å§‹å¤„ç†...
5s    Whisper è¯†åˆ«å®Œæˆï¼ˆå†…éƒ¨ï¼‰
5s    å‘é€åˆ° Ollama
12s   Ollama ç”Ÿæˆå®Œæˆ
13s   TTS ç”Ÿæˆå®Œæˆ
13s   âš¡ ä¸€æ¬¡æ€§æ˜¾ç¤ºå…¨éƒ¨å†…å®¹
      âŒ ç”¨æˆ·ç­‰å¾…äº† 10 ç§’
```

### æ–°ç‰ˆæœ¬æ—¶é—´çº¿
```
0s    ç”¨æˆ·ç‚¹å‡»å½•éŸ³
3s    ç”¨æˆ·è¯´å®Œè¯ï¼Œç‚¹å‡»åœæ­¢
3s    æ˜¾ç¤º "ğŸ¤ æ­£åœ¨è¯†åˆ«è¯­éŸ³..."
5s    âš¡ æ˜¾ç¤º "ğŸ¤ 'ä½ å¥½ï¼Œä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ'"
      âœ… ç”¨æˆ·çœ‹åˆ°è¯†åˆ«ç»“æœï¼ˆåªç­‰äº† 2 ç§’ï¼‰
5s    æ˜¾ç¤ºæ‰“å­—æŒ‡ç¤ºå™¨ â— â— â—
6s    å¼€å§‹æµå¼æ˜¾ç¤ºï¼š"ä»Š"
6.1s  "ä»Šå¤©"
6.2s  "ä»Šå¤©å¤©"
6.3s  "ä»Šå¤©å¤©æ°”"
...
12s   æµå¼æ˜¾ç¤ºå®Œæˆ
13s   è‡ªåŠ¨æ’­æ”¾éŸ³é¢‘
      âœ… ç”¨æˆ·å…¨ç¨‹æœ‰åé¦ˆï¼Œä½“éªŒæµç•…
```

## å…³é”®æŠ€æœ¯ç‚¹

### 1. Server-Sent Events (SSE)
```
Content-Type: text/event-stream

data: {"text": "ä½ "}\n\n
data: {"text": "å¥½"}\n\n
data: {"audio": "...", "done": true}\n\n
```

### 2. ReadableStream API
```javascript
const reader = response.body.getReader();
while (true) {
    const { done, value } = await reader.read();
    if (done) break;
    // å¤„ç†æ•°æ®
}
```

### 3. æ–‡æœ¬ç´¯ç§¯
```python
full_text = ""
for chunk in stream:
    full_text += chunk  # ç´¯ç§¯
    yield chunk         # ç«‹å³å‘é€
# ä½¿ç”¨ full_text ç”ŸæˆéŸ³é¢‘
```

## æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | æ—§ç‰ˆæœ¬ | æ–°ç‰ˆæœ¬ | æ”¹å–„ |
|------|--------|--------|------|
| é¦–æ¬¡åé¦ˆæ—¶é—´ | 10-15s | 2-3s | â¬‡ï¸ 70% |
| ç”¨æˆ·æ„ŸçŸ¥ç­‰å¾… | é•¿ | çŸ­ | â¬†ï¸ 80% |
| äº¤äº’æµç•…åº¦ | ä½ | é«˜ | â¬†ï¸ 90% |
| è¯†åˆ«ç»“æœå¯è§æ€§ | âŒ | âœ… | â¬†ï¸ 100% |

## æ€»ç»“

æ–°ç‰ˆæœ¬é€šè¿‡**ä¸¤æ­¥å¤„ç†**å’Œ**æµå¼è¾“å‡º**ï¼Œå®ç°äº†ï¼š

1. âš¡ **å¿«é€Ÿåé¦ˆ** - è¯­éŸ³è¯†åˆ«ç»“æœç«‹å³æ˜¾ç¤º
2. ğŸ¬ **æ‰“å­—æœºæ•ˆæœ** - AI å›å¤é€å­—æ˜¾ç¤º
3. ğŸ¯ **é€æ˜åº¦** - ç”¨æˆ·çŸ¥é“ç³»ç»Ÿåœ¨åšä»€ä¹ˆ
4. ğŸ˜Š **æ›´å¥½ä½“éªŒ** - å‡å°‘ç­‰å¾…ç„¦è™‘

è¿™æ˜¯ä¸€ä¸ª**ç”Ÿäº§çº§åˆ«**çš„å®ç°ï¼Œå¯ä»¥ç›´æ¥éƒ¨ç½²ä½¿ç”¨ï¼
