# 快速启动指南 - AI 语音助手流式版本

## 启动步骤

### 1. 激活虚拟环境
```bash
.venv\Scripts\activate
```

### 2. 启动语音服务
```bash
python ai_voice_service_offline.py
```

或使用批处理文件：
```bash
start_offline.bat
```

### 3. 访问页面
在浏览器中打开：
```
http://127.0.0.1:8000/ai_health_advisor/
```

## 新功能体验

### 语音输入（推荐测试）
1. 点击麦克风按钮 🎤
2. 说一句话（例如："你好，今天天气怎么样？"）
3. 再次点击停止录音
4. **立即看到**识别结果：🎤 "你好，今天天气怎么样？"
5. AI 回复**逐字显示**（打字机效果）
6. 完成后自动播放语音

### 文字输入
1. 在输入框输入文字
2. 点击发送按钮 ✈️
3. AI 回复**逐字显示**（打字机效果）
4. 完成后自动播放语音

## 功能对比

| 功能 | 旧版本 | 新版本（流式） |
|------|--------|---------------|
| 语音识别显示 | ❌ 只显示 [语音消息] | ✅ 立即显示识别文字 |
| AI 回复方式 | ❌ 一次性全部显示 | ✅ 逐字显示（打字机效果） |
| 用户体验 | 等待时间长，无反馈 | 实时反馈，体验流畅 |

## 技术架构

```
用户语音输入
    ↓
[/transcribe] 快速识别 → 立即显示识别结果
    ↓
[/chat-stream] 流式对话 → 逐字显示 AI 回复
    ↓
语音合成 → 自动播放
```

## 服务状态检查

访问健康检查接口：
```
http://127.0.0.1:8001/health
```

返回示例：
```json
{
  "status": "ok",
  "ollama": "http://172.16.4.181:11434",
  "model": "qwen2.5:7b",
  "whisper_model": "small",
  "asr": "openai-whisper (local)",
  "tts": "edge-tts (Microsoft Chinese)"
}
```

## 常见问题

### Q: 语音识别不准确？
A: 已升级到 `small` 模型，准确度提升 20-30%。说话时尽量清晰，避免环境噪音。

### Q: 流式输出卡顿？
A: 检查 Ollama 服务是否正常运行，网络连接是否稳定。

### Q: 音频无法播放？
A: 检查浏览器是否允许自动播放音频，某些浏览器需要用户交互后才能播放。

### Q: 识别结果不显示？
A: 检查后端日志，确认 `/transcribe` 接口是否正常响应。

## 日志查看

后端服务会输出详细日志：
```
2026-01-30 17:00:00,000 - __main__ - INFO - 收到语音识别请求
2026-01-30 17:00:00,100 - __main__ - INFO - 识别结果: 你好，今天天气怎么样？
2026-01-30 17:00:00,200 - __main__ - INFO - 收到流式对话请求: 你好，今天天气怎么样？
2026-01-30 17:00:02,000 - __main__ - INFO - 流式输出完成，开始生成语音
```

## 性能优化建议

1. **Whisper 模型选择**
   - `tiny`: 最快，准确度最低
   - `base`: 平衡（旧版本）
   - `small`: 更准确（当前版本）✅
   - `medium`: 很准确，较慢
   - `large`: 最准确，最慢

2. **Ollama 模型选择**
   - 当前：`qwen2.5:7b`
   - 可选：`qwen2.5:14b`（更准确，更慢）

3. **网络优化**
   - 确保 Ollama 服务在局域网内
   - 使用有线网络而非 WiFi

## 下一步优化方向

- [ ] 支持多轮对话上下文
- [ ] 添加语音情感识别
- [ ] 支持多语言切换
- [ ] 添加对话历史记录
- [ ] 优化移动端体验

## 技术支持

如有问题，请查看：
- `STREAMING_IMPLEMENTATION.md` - 详细技术文档
- `AI_VOICE_README.md` - 原始功能文档
- 后端日志输出

祝使用愉快！🎉
